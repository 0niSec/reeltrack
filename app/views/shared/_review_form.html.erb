<div class="mt-4">
    <%= form_with(url: movie_reviews_path(movie_id: movie.tmdb_id), 
                model: MovieReview.new,
                local: false,
                data: { turbo_frame: "movie_reviews" }) do |form| %>

        <%# Watched Date and Rating Row %>
        <div class="flex items-center gap-10 mb-4">
            <%# Watched Date %>
            <div class="relative">
                <label class="block text-sm text-primary-400 mb-1">Watched on</label>
                <%= form.date_field :watched_on,
                    value: Time.current.to_date,
                    class: "bg-neutral-800 text-primary-400 border border-neutral-700 rounded-md px-3 py-1.5 focus:ring-primary-500 focus:border-primary-500" %>
            </div>

            <%# Star Rating %>
            <div>
                <label class="block text-sm text-primary-400 mb-1">Rating</label>
                <div class="relative flex items-center group" data-controller="rating">
                    <%# Clear rating button %>
                    <div class="absolute right-full items-center flex opacity-0 transition-opacity duration-200 ease-out group-hover:opacity-100 pr-2">
                        <button type="button" 
                                class="text-neutral-600 hover:text-primary-400 w-5 h-5"
                                data-action="click->rating#clearRating">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                            </svg>
                        </button>
                    </div>

                    <%= form.hidden_field :rating, data: { rating_target: "input" }, value: 0 %>

                    <%# Stars  %>
                    <div class="flex">
                        <% 5.times do |i| %>
                            <div class="relative w-8 h-8">
                                <%# Left half star %>
                                <div class="cursor-pointer absolute inset-0 w-4 h-8"
                                     data-rating-target="star"
                                     data-value="<%= i * 1.0 + 0.5 %>"
                                     data-action="mouseenter->rating#mouseEnter mouseleave->rating#mouseLeave click->rating#setRating">
                                    <svg xmlns="http://www.w3.org/2000/svg" 
                                         viewBox="0 0 24 24"
                                         class="w-8 h-8 text-neutral-600 transition-colors"
                                         style="clip-path: inset(0 50% 0 0);">
                                        <path fill="currentColor" 
                                              d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z" />
                                    </svg>
                                </div>

                                <%# Right half star %>
                                <div class="cursor-pointer absolute inset-0 left-4 w-4 h-8"
                                     data-rating-target="star"
                                     data-value="<%= i * 1.0 + 1.0 %>"
                                     data-action="mouseenter->rating#mouseEnter mouseleave->rating#mouseLeave click->rating#setRating">
                                    <svg xmlns="http://www.w3.org/2000/svg" 
                                         viewBox="0 0 24 24"
                                         class="w-8 h-8 text-neutral-600 transition-colors"
                                         style="clip-path: inset(0 0 0 50%); margin-left: -16px;">
                                        <path fill="currentColor" 
                                              d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z" />
                                    </svg>
                                </div>
                            </div>
                        <% end %>
                    </div>
                </div>
            </div>
        </div>

        <%# Review Text %>
        <div class="mb-4">
            <%= form.text_area :content, 
                rows: 4, 
                placeholder: "Add a review...",
                class: "w-full bg-neutral-800 text-primary-400 border border-neutral-700 rounded-md px-3 py-2 placeholder:text-neutral-500 focus:ring-primary-500 focus:border-primary-500" %>
        </div>

        <%= form.submit "Save", 
            class: "px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600 transition-colors" %>
    <% end %>
</div>